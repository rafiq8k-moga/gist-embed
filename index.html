<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gist Embed</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, button { padding: 10px; margin-top: 10px; width: 100%; }
    textarea { width: 100%; height: 100px; margin-top: 10px; }
    .embed-container { margin-top: 20px; }
  </style>
</head>
<body>
  <div id="app">
    <div id="form-ui" style="display:none;">
      <h2>Gist Embed Generator</h2>
      <p>Masukkan URL Gist kamu (contoh: <code>https://gist.github.com/username/gistid</code>)</p>
      <input type="text" id="gist-url" placeholder="https://gist.github.com/username/gistid" />
      <button onclick="generateEmbed()">Generate Embed URL</button>
      <textarea id="output-url" readonly placeholder="URL akan muncul di sini..."></textarea>
    </div>

    <div id="embed-output" class="embed-container"></div>
  </div>

  <script>
  function getParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name);
  }

  function base64Encode(str) {
    return btoa(unescape(encodeURIComponent(str)));
  }

  function base64Decode(str) {
    try {
      return decodeURIComponent(escape(atob(str)));
    } catch (e) {
      return null;
    }
  }

  function generateEmbed() {
    const url = document.getElementById('gist-url').value.trim();
    const match = url.match(/^https:\/\/gist\.github\.com\/([^\/]+)\/([a-f0-9]+)$/i);

    if (!match) {
      alert("URL harus berupa format: https://gist.github.com/username/gistid");
      return;
    }

    const embedUrl = `${url}.js`;
    const embedCode = `<script src="${embedUrl}"></script>`;
    const encoded = base64Encode(embedCode);
    const resultUrl = `${window.location.origin}${window.location.pathname}?gist=${encoded}`;
    document.getElementById('output-url').value = resultUrl;
  }

  (function init() {
    const gistParam = getParam('gist');

    if (gistParam) {
      const decoded = base64Decode(gistParam);

      if (decoded) {
        document.getElementById('embed-output').innerHTML = decoded;
      } else {
        document.getElementById('embed-output').innerHTML = `
          <p style="color:red;">Gagal decode parameter gist.</p>
        `;
      }
    } else {
      document.getElementById('form-ui').style.display = 'block';
    }
  })();
</script>
</body>
</html>
